# 工控系统点表管理平台 V2.0 - 重构设计方案

## 项目概览

这是一个高度可扩展的工控系统点表管理平台，采用前后端分离架构，前端使用Angular框架，后端使用Rust语言。系统设计核心理念是**插件化架构**和**高扩展性**，确保功能需求变化时不会产生连锁反应，支持快速添加新的PLC品牌、HMI软件、数据源和AI服务。

### 核心设计原则

1. **插件化架构**：所有可变功能都通过插件实现，避免硬编码
2. **接口驱动**：定义清晰的接口规范，支持第三方扩展
3. **数据源无关**：支持简道云、自定义API、AI解析等多种数据源
4. **文件格式兼容**：支持xls、xlsx、csv、json、xml等多种格式
5. **国际化支持**：完整的中英文切换功能
6. **角色权限**：细粒度的用户权限管理
7. **微服务友好**：模块化设计，支持独立部署和扩展

### 系统特色功能

- **智能PLC配置**：支持多品牌PLC模块选择、机架配置、IO通道映射
- **第三方设备管理**：模板化管理第三方设备点表
- **多格式文件处理**：Rust+Python混合处理复杂Excel文件
- **AI集成**：支持AI读取设计文件并返回结构化数据
- **插件式点表生成**：支持多种PLC和HMI品牌的点表生成
- **数据源适配器**：统一的数据源接口，支持多种数据来源

## 系统架构

### 1. 总体架构设计

```
工控系统点表管理平台 V2.0
├── backend/                    # Rust后端服务
│   ├── core/                   # 核心框架
│   │   ├── api/                # RESTful API接口层
│   │   ├── services/           # 业务服务层
│   │   ├── models/             # 数据模型层
│   │   ├── repositories/       # 数据访问层
│   │   └── middleware/         # 中间件
│   ├── plugins/                # 插件系统
│   │   ├── plc/                # PLC品牌插件
│   │   ├── hmi/                # HMI软件插件
│   │   ├── data_source/        # 数据源插件
│   │   ├── file_processor/     # 文件处理插件
│   │   └── ai_integration/     # AI集成插件
│   ├── utils/                  # 工具库
│   │   ├── file_handler/       # 文件处理工具
│   │   ├── python_bridge/      # Python桥接
│   │   └── validators/         # 数据验证
│   └── migrations/             # 数据库迁移
│
├── frontend/                   # Angular前端应用
│   ├── src/
│   │   ├── app/
│   │   │   ├── core/           # 核心模块
│   │   │   │   ├── auth/       # 认证模块
│   │   │   │   ├── i18n/       # 国际化
│   │   │   │   └── services/   # 核心服务
│   │   │   ├── shared/         # 共享模块
│   │   │   │   ├── components/ # 通用组件
│   │   │   │   └── models/     # 数据模型
│   │   │   ├── features/       # 功能模块
│   │   │   │   ├── admin/      # 管理功能
│   │   │   │   ├── project/    # 项目管理
│   │   │   │   ├── station/    # 场站管理
│   │   │   │   ├── device/     # 设备管理
│   │   │   │   ├── plc-config/ # PLC配置
│   │   │   │   ├── third-party/# 第三方设备
│   │   │   │   └── io-processing/ # IO点表处理
│   │   │   └── layouts/        # 布局组件
│   │   └── assets/             # 静态资源
│   └── plugins/                # 前端插件
│       ├── file-processors/    # 文件处理插件
│       └── ui-extensions/      # UI扩展插件
│
├── python-services/            # Python微服务
│   ├── excel-processor/        # Excel处理服务
│   ├── ai-integration/         # AI集成服务
│   └── file-converter/         # 文件转换服务
│
├── shared/                     # 共享资源
│   ├── schemas/                # 数据模式定义
│   ├── protocols/              # 通信协议
│   └── configs/                # 配置文件
│
└── deployment/                 # 部署配置
    ├── docker/                 # Docker配置
    ├── kubernetes/             # K8s配置
    └── nginx/                  # 反向代理配置
```

### 2. 后端架构 (Rust) - 插件化设计

```
backend/
├── src/
│   ├── main.rs                 # 应用入口点
│   ├── lib.rs                  # 库入口
│   │
│   ├── core/                   # 核心框架
│   │   ├── mod.rs              # 核心模块导出
│   │   ├── app.rs              # 应用配置和启动
│   │   ├── config.rs           # 配置管理
│   │   ├── error.rs            # 错误处理
│   │   ├── plugin_manager.rs   # 插件管理器
│   │   └── traits/             # 核心接口定义
│   │       ├── mod.rs
│   │       ├── plc_plugin.rs   # PLC插件接口
│   │       ├── hmi_plugin.rs   # HMI插件接口
│   │       ├── data_source.rs  # 数据源接口
│   │       ├── file_processor.rs # 文件处理接口
│   │       └── ai_service.rs   # AI服务接口
│   │
│   ├── api/                    # API接口层
│   │   ├── mod.rs              # API模块导出
│   │   ├── auth.rs             # 认证API
│   │   ├── admin.rs            # 管理API (用户/角色)
│   │   ├── projects.rs         # 项目管理API
│   │   ├── stations.rs         # 场站管理API
│   │   ├── devices.rs          # 设备管理API
│   │   ├── plc_config.rs       # PLC配置API
│   │   ├── third_party.rs      # 第三方设备API
│   │   ├── io_processing.rs    # IO点表处理API
│   │   ├── data_sources.rs     # 数据源API
│   │   ├── ai_integration.rs   # AI集成API
│   │   ├── file_upload.rs      # 文件上传API
│   │   └── point_generation.rs # 点表生成API
│   │
│   ├── services/               # 业务服务层
│   │   ├── mod.rs
│   │   ├── auth_service.rs     # 认证服务
│   │   ├── user_service.rs     # 用户管理服务
│   │   ├── role_service.rs     # 角色管理服务
│   │   ├── project_service.rs  # 项目服务
│   │   ├── station_service.rs  # 场站服务
│   │   ├── device_service.rs   # 设备服务
│   │   ├── plc_service.rs      # PLC配置服务
│   │   ├── third_party_service.rs # 第三方设备服务
│   │   ├── io_service.rs       # IO点表服务
│   │   ├── data_source_service.rs # 数据源服务
│   │   ├── ai_service.rs       # AI集成服务
│   │   └── plugin_service.rs   # 插件管理服务
│   │
│   ├── models/                 # 数据模型层
│   │   ├── mod.rs
│   │   ├── user.rs             # 用户模型
│   │   ├── role.rs             # 角色模型
│   │   ├── project.rs          # 项目模型
│   │   ├── station.rs          # 场站模型
│   │   ├── device.rs           # 设备模型
│   │   ├── plc/                # PLC相关模型
│   │   │   ├── mod.rs
│   │   │   ├── module.rs       # PLC模块模型
│   │   │   ├── rack.rs         # PLC机架模型
│   │   │   ├── configuration.rs # PLC配置模型
│   │   │   └── io_channel.rs   # IO通道模型
│   │   ├── io_point.rs         # IO点位模型
│   │   ├── third_party.rs      # 第三方设备模型
│   │   ├── data_source.rs      # 数据源模型
│   │   └── common.rs           # 通用模型
│   │
│   ├── repositories/           # 数据访问层
│   │   ├── mod.rs
│   │   ├── database.rs         # 数据库连接管理
│   │   ├── user_repo.rs        # 用户数据访问
│   │   ├── role_repo.rs        # 角色数据访问
│   │   ├── project_repo.rs     # 项目数据访问
│   │   ├── station_repo.rs     # 场站数据访问
│   │   ├── device_repo.rs      # 设备数据访问
│   │   ├── plc_repo.rs         # PLC配置数据访问
│   │   ├── io_point_repo.rs    # IO点位数据访问
│   │   ├── third_party_repo.rs # 第三方设备数据访问
│   │   └── data_source_repo.rs # 数据源数据访问
│   │
│   ├── plugins/                # 插件系统实现
│   │   ├── mod.rs              # 插件模块导出
│   │   │
│   │   ├── plc/                # PLC品牌插件
│   │   │   ├── mod.rs
│   │   │   ├── hollysys/       # 和利时PLC插件
│   │   │   │   ├── mod.rs
│   │   │   │   ├── standard.rs # 标准型
│   │   │   │   ├── safety.rs   # 安全型
│   │   │   │   └── modbus.rs   # Modbus表
│   │   │   ├── siemens/        # 西门子PLC插件
│   │   │   │   ├── mod.rs
│   │   │   │   ├── s7_1200.rs
│   │   │   │   └── s7_1500.rs
│   │   │   ├── cticpl/         # 中控PLC插件
│   │   │   │   └── mod.rs
│   │   │   └── plugin_registry.rs # PLC插件注册器
│   │   │
│   │   ├── hmi/                # HMI软件插件
│   │   │   ├── mod.rs
│   │   │   ├── yacon/          # 亚控组态插件
│   │   │   │   └── mod.rs
│   │   │   ├── kingview/       # 力控组态插件
│   │   │   │   └── mod.rs
│   │   │   ├── wincc/          # WinCC插件
│   │   │   │   └── mod.rs
│   │   │   └── plugin_registry.rs # HMI插件注册器
│   │   │
│   │   ├── data_source/        # 数据源插件
│   │   │   ├── mod.rs
│   │   │   ├── jiandaoyun/     # 简道云插件
│   │   │   │   ├── mod.rs
│   │   │   │   ├── api_client.rs
│   │   │   │   └── data_mapper.rs
│   │   │   ├── custom_api/     # 自定义API插件
│   │   │   │   └── mod.rs
│   │   │   ├── database/       # 数据库直连插件
│   │   │   │   └── mod.rs
│   │   │   └── plugin_registry.rs # 数据源插件注册器
│   │   │
│   │   ├── file_processor/     # 文件处理插件
│   │   │   ├── mod.rs
│   │   │   ├── excel/          # Excel处理插件
│   │   │   │   ├── mod.rs
│   │   │   │   ├── rust_native.rs # Rust原生处理
│   │   │   │   └── python_bridge.rs # Python桥接处理
│   │   │   ├── csv/            # CSV处理插件
│   │   │   │   └── mod.rs
│   │   │   ├── xml/            # XML处理插件
│   │   │   │   └── mod.rs
│   │   │   └── json/           # JSON处理插件
│   │   │       └── mod.rs
│   │   │
│   │   └── ai_integration/     # AI集成插件
│   │       ├── mod.rs
│   │       ├── openai/         # OpenAI插件
│   │       │   └── mod.rs
│   │       ├── claude/         # Claude插件
│   │       │   └── mod.rs
│   │       ├── custom_ai/      # 自定义AI插件
│   │       │   └── mod.rs
│   │       └── plugin_registry.rs # AI插件注册器
│   │
│   ├── utils/                  # 工具库
│   │   ├── mod.rs
│   │   ├── file_handler/       # 文件处理工具
│   │   │   ├── mod.rs
│   │   │   ├── upload.rs       # 文件上传处理
│   │   │   ├── validation.rs   # 文件验证
│   │   │   └── converter.rs    # 文件格式转换
│   │   ├── python_bridge/      # Python桥接
│   │   │   ├── mod.rs
│   │   │   ├── executor.rs     # Python执行器
│   │   │   └── data_exchange.rs # 数据交换
│   │   ├── validators/         # 数据验证
│   │   │   ├── mod.rs
│   │   │   ├── plc_validator.rs # PLC配置验证
│   │   │   ├── io_validator.rs  # IO点表验证
│   │   │   └── file_validator.rs # 文件格式验证
│   │   ├── generators/         # 点表生成器
│   │   │   ├── mod.rs
│   │   │   ├── template_engine.rs # 模板引擎
│   │   │   └── export_formatter.rs # 导出格式化
│   │   ├── i18n.rs             # 国际化支持
│   │   ├── logging.rs          # 日志系统
│   │   └── crypto.rs           # 加密工具
│   │
│   └── middleware/             # 中间件
│       ├── mod.rs
│       ├── auth.rs             # 认证中间件
│       ├── cors.rs             # CORS中间件
│       ├── logging.rs          # 日志中间件
│       ├── rate_limit.rs       # 限流中间件
│       └── i18n.rs             # 国际化中间件
│
├── Cargo.toml                  # Rust项目配置
├── migrations/                 # 数据库迁移文件
├── tests/                      # 测试文件
├── docs/                       # 文档
└── .env.example                # 环境变量示例
```

### 3. 前端架构 (Angular) - 模块化设计

```
frontend/
├── src/
│   ├── app/
│   │   ├── app.module.ts           # 根模块
│   │   ├── app-routing.module.ts   # 路由配置
│   │   ├── app.component.ts        # 根组件
│   │   │
│   │   ├── core/                   # 核心模块 (单例)
│   │   │   ├── core.module.ts      # 核心模块定义
│   │   │   ├── auth/               # 认证模块
│   │   │   │   ├── login/          # 登录组件
│   │   │   │   │   ├── login.component.ts
│   │   │   │   │   ├── login.component.html
│   │   │   │   │   └── login.component.scss
│   │   │   │   ├── guards/         # 路由守卫
│   │   │   │   │   ├── auth.guard.ts
│   │   │   │   │   └── role.guard.ts
│   │   │   │   └── services/       # 认证服务
│   │   │   │       ├── auth.service.ts
│   │   │   │       ├── token.service.ts
│   │   │   │       └── permission.service.ts
│   │   │   ├── http/               # HTTP相关
│   │   │   │   ├── interceptors/   # HTTP拦截器
│   │   │   │   │   ├── auth.interceptor.ts
│   │   │   │   │   ├── error.interceptor.ts
│   │   │   │   │   └── loading.interceptor.ts
│   │   │   │   └── api.service.ts  # 基础API服务
│   │   │   ├── services/           # 核心服务
│   │   │   │   ├── config.service.ts
│   │   │   │   ├── notification.service.ts
│   │   │   │   ├── loading.service.ts
│   │   │   │   └── plugin.service.ts
│   │   │   └── i18n/               # 国际化
│   │   │       ├── i18n.module.ts
│   │   │       ├── i18n.service.ts
│   │   │       └── language-selector/
│   │   │           ├── language-selector.component.ts
│   │   │           ├── language-selector.component.html
│   │   │           └── language-selector.component.scss
│   │   │
│   │   ├── shared/                 # 共享模块
│   │   │   ├── shared.module.ts    # 共享模块定义
│   │   │   ├── components/         # 共享组件
│   │   │   │   ├── transfer-list/  # 穿梭框组件
│   │   │   │   │   ├── transfer-list.component.ts
│   │   │   │   │   ├── transfer-list.component.html
│   │   │   │   │   ├── transfer-list.component.scss
│   │   │   │   │   └── transfer-list.interface.ts
│   │   │   │   ├── file-upload/    # 文件上传组件
│   │   │   │   │   ├── file-upload.component.ts
│   │   │   │   │   ├── file-upload.component.html
│   │   │   │   │   ├── file-upload.component.scss
│   │   │   │   │   └── file-upload.interface.ts
│   │   │   │   ├── status-bar/     # 状态栏组件
│   │   │   │   │   ├── status-bar.component.ts
│   │   │   │   │   ├── status-bar.component.html
│   │   │   │   │   └── status-bar.component.scss
│   │   │   │   ├── data-table/     # 数据表格组件
│   │   │   │   │   ├── data-table.component.ts
│   │   │   │   │   ├── data-table.component.html
│   │   │   │   │   └── data-table.component.scss
│   │   │   │   ├── confirmation-dialog/ # 确认对话框
│   │   │   │   │   ├── confirmation-dialog.component.ts
│   │   │   │   │   ├── confirmation-dialog.component.html
│   │   │   │   │   └── confirmation-dialog.component.scss
│   │   │   │   └── loading-spinner/ # 加载动画
│   │   │   │       ├── loading-spinner.component.ts
│   │   │   │       ├── loading-spinner.component.html
│   │   │   │       └── loading-spinner.component.scss
│   │   │   ├── directives/         # 共享指令
│   │   │   │   ├── permission.directive.ts
│   │   │   │   └── drag-drop.directive.ts
│   │   │   ├── pipes/              # 共享管道
│   │   │   │   ├── translate.pipe.ts
│   │   │   │   ├── file-size.pipe.ts
│   │   │   │   └── date-format.pipe.ts
│   │   │   ├── models/             # 共享数据模型
│   │   │   │   ├── user.model.ts
│   │   │   │   ├── role.model.ts
│   │   │   │   ├── project.model.ts
│   │   │   │   ├── station.model.ts
│   │   │   │   ├── device.model.ts
│   │   │   │   ├── plc.model.ts
│   │   │   │   ├── io-point.model.ts
│   │   │   │   └── common.model.ts
│   │   │   └── utils/              # 工具函数
│   │   │       ├── validators.ts
│   │   │       ├── formatters.ts
│   │   │       └── helpers.ts
│   │   │
│   │   ├── features/               # 功能模块
│   │   │   ├── admin/              # 管理模块
│   │   │   │   ├── admin.module.ts
│   │   │   │   ├── admin-routing.module.ts
│   │   │   │   ├── user-management/ # 用户管理
│   │   │   │   │   ├── user-list/
│   │   │   │   │   │   ├── user-list.component.ts
│   │   │   │   │   │   ├── user-list.component.html
│   │   │   │   │   │   └── user-list.component.scss
│   │   │   │   │   ├── user-form/
│   │   │   │   │   │   ├── user-form.component.ts
│   │   │   │   │   │   ├── user-form.component.html
│   │   │   │   │   │   └── user-form.component.scss
│   │   │   │   │   └── user.service.ts
│   │   │   │   └── role-management/ # 角色管理
│   │   │   │       ├── role-list/
│   │   │   │       │   ├── role-list.component.ts
│   │   │   │       │   ├── role-list.component.html
│   │   │   │       │   └── role-list.component.scss
│   │   │   │       ├── role-form/
│   │   │   │       │   ├── role-form.component.ts
│   │   │   │       │   ├── role-form.component.html
│   │   │   │       │   └── role-form.component.scss
│   │   │   │       └── role.service.ts
│   │   │   │
│   │   │   ├── project/            # 项目管理模块
│   │   │   │   ├── project.module.ts
│   │   │   │   ├── project-routing.module.ts
│   │   │   │   ├── project-list/   # 项目列表
│   │   │   │   │   ├── project-list.component.ts
│   │   │   │   │   ├── project-list.component.html
│   │   │   │   │   └── project-list.component.scss
│   │   │   │   ├── project-detail/ # 项目详情
│   │   │   │   │   ├── project-detail.component.ts
│   │   │   │   │   ├── project-detail.component.html
│   │   │   │   │   └── project-detail.component.scss
│   │   │   │   ├── project-form/   # 项目表单
│   │   │   │   │   ├── project-form.component.ts
│   │   │   │   │   ├── project-form.component.html
│   │   │   │   │   └── project-form.component.scss
│   │   │   │   └── project.service.ts
│   │   │   │
│   │   │   ├── station/            # 场站管理模块
│   │   │   │   ├── station.module.ts
│   │   │   │   ├── station-routing.module.ts
│   │   │   │   ├── station-list/   # 场站列表
│   │   │   │   ├── station-detail/ # 场站详情
│   │   │   │   ├── station-form/   # 场站表单
│   │   │   │   └── station.service.ts
│   │   │   │
│   │   │   ├── device/             # 设备管理模块
│   │   │   │   ├── device.module.ts
│   │   │   │   ├── device-routing.module.ts
│   │   │   │   ├── device-list/    # 设备列表
│   │   │   │   ├── device-detail/  # 设备详情
│   │   │   │   ├── device-form/    # 设备表单
│   │   │   │   └── device.service.ts
│   │   │   │
│   │   │   ├── plc-config/         # PLC配置模块
│   │   │   │   ├── plc-config.module.ts
│   │   │   │   ├── plc-config-routing.module.ts
│   │   │   │   ├── module-selection/ # 模块选择
│   │   │   │   │   ├── module-selection.component.ts
│   │   │   │   │   ├── module-selection.component.html
│   │   │   │   │   └── module-selection.component.scss
│   │   │   │   ├── rack-config/    # 机架配置
│   │   │   │   │   ├── rack-config.component.ts
│   │   │   │   │   ├── rack-config.component.html
│   │   │   │   │   └── rack-config.component.scss
│   │   │   │   ├── io-channel-mapping/ # IO通道映射
│   │   │   │   │   ├── io-channel-mapping.component.ts
│   │   │   │   │   ├── io-channel-mapping.component.html
│   │   │   │   │   ├── io-channel-mapping.component.scss
│   │   │   │   │   └── channel-mapping-dialog/
│   │   │   │   │       ├── channel-mapping-dialog.component.ts
│   │   │   │   │       ├── channel-mapping-dialog.component.html
│   │   │   │   │       └── channel-mapping-dialog.component.scss
│   │   │   │   ├── config-validation/ # 配置验证
│   │   │   │   │   ├── config-validation.component.ts
│   │   │   │   │   ├── config-validation.component.html
│   │   │   │   │   └── config-validation.component.scss
│   │   │   │   ├── config-management/ # 配置管理
│   │   │   │   │   ├── config-management.component.ts
│   │   │   │   │   ├── config-management.component.html
│   │   │   │   │   └── config-management.component.scss
│   │   │   │   └── plc-config.service.ts
│   │   │   │
│   │   │   ├── third-party/        # 第三方设备模块
│   │   │   │   ├── third-party.module.ts
│   │   │   │   ├── third-party-routing.module.ts
│   │   │   │   ├── template-management/ # 模板管理
│   │   │   │   │   ├── template-list/
│   │   │   │   │   │   ├── template-list.component.ts
│   │   │   │   │   │   ├── template-list.component.html
│   │   │   │   │   │   └── template-list.component.scss
│   │   │   │   │   ├── template-form/
│   │   │   │   │   │   ├── template-form.component.ts
│   │   │   │   │   │   ├── template-form.component.html
│   │   │   │   │   │   └── template-form.component.scss
│   │   │   │   │   └── template.service.ts
│   │   │   │   ├── device-instance/  # 设备实例
│   │   │   │   │   ├── device-instance-list/
│   │   │   │   │   ├── device-instance-form/
│   │   │   │   │   └── device-instance.service.ts
│   │   │   │   └── point-config/     # 点位配置
│   │   │   │       ├── point-config.component.ts
│   │   │   │       ├── point-config.component.html
│   │   │   │       ├── point-config.component.scss
│   │   │   │       └── point-config.service.ts
│   │   │   │
│   │   │   └── io-processing/      # IO点表处理模块
│   │   │       ├── io-processing.module.ts
│   │   │       ├── io-processing-routing.module.ts
│   │   │       ├── upload/         # 上传处理
│   │   │       │   ├── file-upload/
│   │   │   │   │   ├── file-upload.component.ts
│   │   │   │   │   ├── file-upload.component.html
│   │   │   │   │   └── file-upload.component.scss
│   │   │   │   └── upload.service.ts
│   │   │   ├── validation/     # 验证处理
│   │   │   │   ├── validation-result/
│   │   │   │   │   ├── validation-result.component.ts
│   │   │   │   │   ├── validation-result.component.html
│   │   │   │   │   └── validation-result.component.scss
│   │   │   │   └── validation.service.ts
│   │   │   └── generation/     # 点表生成
│   │   │           ├── plc-table/  # PLC点表生成
│   │   │           │   ├── plc-table-generator.component.ts
│   │   │           │   ├── plc-table-generator.component.html
│   │   │           │   └── plc-table-generator.component.scss
│   │   │           ├── hmi-table/  # HMI点表生成
│   │   │           │   ├── hmi-table-generator.component.ts
│   │   │           │   ├── hmi-table-generator.component.html
│   │   │           │   └── hmi-table-generator.component.scss
│   │   │           ├── other-table/ # 其他点表生成
│   │   │           │   ├── other-table-generator.component.ts
│   │   │           │   ├── other-table-generator.component.html
│   │   │           │   └── other-table-generator.component.scss
│   │   │           └── generation.service.ts
│   │   │
│   │   └── layouts/                # 布局组件
│   │       ├── main-layout/        # 主布局
│   │       │   ├── main-layout.component.ts
│   │       │   ├── main-layout.component.html
│   │       │   └── main-layout.component.scss
│   │       ├── header/             # 页头组件
│   │       │   ├── header.component.ts
│   │       │   ├── header.component.html
│   │       │   ├── header.component.scss
│   │       │   └── user-menu/      # 用户菜单
│   │       │       ├── user-menu.component.ts
│   │       │       ├── user-menu.component.html
│   │       │       └── user-menu.component.scss
│   │       ├── sidebar/            # 侧边栏
│   │       │   ├── sidebar.component.ts
│   │       │   ├── sidebar.component.html
│   │       │   ├── sidebar.component.scss
│   │       │   └── menu-item/      # 菜单项
│   │       │       ├── menu-item.component.ts
│   │       │       ├── menu-item.component.html
│   │       │       └── menu-item.component.scss
│   │       └── footer/             # 页脚
│   │           ├── footer.component.ts
│   │           ├── footer.component.html
│   │           └── footer.component.scss
│   │
│   ├── assets/                     # 静态资源
│   │   ├── images/                 # 图片资源
│   │   │   ├── logo/
│   │   │   ├── icons/
│   │   │   └── backgrounds/
│   │   ├── styles/                 # 样式文件
│   │   │   ├── themes/             # 主题样式
│   │   │   │   ├── light.scss
│   │   │   │   └── dark.scss
│   │   │   ├── variables.scss      # SCSS变量
│   │   │   └── mixins.scss         # SCSS混入
│   │   ├── i18n/                   # 国际化资源
│   │   │   ├── zh.json             # 中文翻译
│   │   │   └── en.json             # 英文翻译
│   │   ├── configs/                # 配置文件
│   │   │   ├── menu.json           # 菜单配置
│   │   │   └── permissions.json    # 权限配置
│   │   └── data/                   # 静态数据
│   │       ├── plc-modules.json    # PLC模块数据
│   │       └── device-templates.json # 设备模板数据
│   │
│   ├── environments/               # 环境配置
│   │   ├── environment.ts          # 开发环境
│   │   ├── environment.prod.ts     # 生产环境
│   │   └── environment.test.ts     # 测试环境
│   │
│   ├── styles/                     # 全局样式
│   │   ├── styles.scss             # 全局样式入口
│   │   ├── _variables.scss         # 全局变量
│   │   └── _mixins.scss            # 全局混入
│   │
│   ├── index.html                  # HTML入口
│   ├── main.ts                     # TypeScript入口
│   ├── polyfills.ts                # 兼容性填充
│   └── test.ts                     # 测试配置
│
├── plugins/                        # 前端插件系统
│   ├── file-processors/            # 文件处理插件
│   │   ├── excel-processor/
│   │   │   ├── excel-processor.plugin.ts
│   │   │   └── excel-processor.interface.ts
│   │   ├── csv-processor/
│   │   │   ├── csv-processor.plugin.ts
│   │   │   └── csv-processor.interface.ts
│   │   └── xml-processor/
│   │       ├── xml-processor.plugin.ts
│   │       └── xml-processor.interface.ts
│   └── ui-extensions/              # UI扩展插件
│       ├── chart-extensions/
│       └── table-extensions/
│
├── angular.json                    # Angular配置
├── package.json                    # 依赖配置
├── tsconfig.json                   # TypeScript配置
├── tsconfig.app.json               # 应用TypeScript配置
├── tsconfig.spec.json              # 测试TypeScript配置
└── karma.conf.js                   # 测试配置
```

## 技术栈选择与插件系统设计

### 后端技术栈 (Rust)

#### 1. 核心框架
- **Axum**: 高性能异步Web框架，支持中间件和插件扩展
- **Tokio**: 异步运行时，支持高并发处理
- **Tower**: 中间件生态系统，便于扩展功能

#### 2. 数据库与存储
- **PostgreSQL**: 主数据库，支持JSON字段存储插件配置
- **SQLx**: 编译时检查的SQL库，类型安全
- **Redis**: 缓存和会话管理，支持插件状态缓存
- **SeaORM**: 可选的ORM，支持动态查询

#### 3. 文件处理
- **Calamine**: Rust原生Excel处理，支持基础格式
- **PyO3**: Rust与Python桥接，处理复杂Excel操作
- **quick-xml**: 高性能XML处理
- **csv**: CSV文件处理
- **serde_json**: JSON序列化/反序列化

#### 4. 插件系统核心
- **libloading**: 动态库加载，支持运行时插件加载
- **inventory**: 编译时插件注册
- **async-trait**: 异步trait支持
- **dyn-clone**: 动态克隆支持

#### 5. 其他工具
- **jsonwebtoken**: JWT认证
- **tracing**: 结构化日志和追踪
- **config**: 配置文件管理
- **validator**: 数据验证
- **reqwest**: HTTP客户端，用于外部API调用

### 前端技术栈 (Angular)

#### 1. UI框架与组件
- **NG-ZORRO**: 企业级UI组件库，支持主题定制
- **Angular CDK**: 组件开发工具包
- **Angular Material**: 可选的Material Design组件

#### 2. 状态管理
- **NgRx**: Redux模式状态管理
- **NgRx Effects**: 副作用处理
- **NgRx Entity**: 实体状态管理

#### 3. 国际化与主题
- **ngx-translate**: 国际化支持
- **Angular Flex-Layout**: 响应式布局
- **SCSS**: 样式预处理器

#### 4. 文件处理
- **SheetJS (xlsx)**: 前端Excel文件处理
- **file-saver**: 文件下载
- **ngx-file-drop**: 拖拽文件上传

#### 5. 图表与表格
- **ag-Grid**: 企业级数据表格
- **ngx-echarts**: 图表组件
- **ngx-datatable**: 轻量级表格组件

### Python微服务技术栈

#### 1. 核心框架
- **FastAPI**: 高性能API框架
- **Pydantic**: 数据验证和序列化

#### 2. Excel处理
- **openpyxl**: Excel文件读写
- **xlrd/xlwt**: 老版本Excel支持
- **pandas**: 数据处理和分析

#### 3. AI集成
- **openai**: OpenAI API客户端
- **anthropic**: Claude API客户端
- **langchain**: AI应用开发框架

## 插件系统架构设计

### 1. 插件接口定义

#### PLC插件接口
```rust
#[async_trait]
pub trait PlcPlugin: Send + Sync {
    fn name(&self) -> &str;
    fn version(&self) -> &str;
    fn supported_series(&self) -> Vec<String>;
    
    async fn get_modules(&self, series: &str) -> Result<Vec<PlcModule>>;
    async fn validate_config(&self, config: &PlcConfiguration) -> Result<ValidationResult>;
    async fn generate_point_table(&self, config: &PlcConfiguration, format: &str) -> Result<Vec<u8>>;
    
    // 扩展接口
    fn supports_safety(&self) -> bool { false }
    fn supports_modbus(&self) -> bool { false }
    async fn generate_safety_table(&self, config: &PlcConfiguration) -> Result<Vec<u8>> {
        Err("Safety table not supported".into())
    }
}
```

#### HMI插件接口
```rust
#[async_trait]
pub trait HmiPlugin: Send + Sync {
    fn name(&self) -> &str;
    fn version(&self) -> &str;
    fn supported_versions(&self) -> Vec<String>;
    
    async fn generate_point_table(&self, io_points: &[IoPoint], format: &str) -> Result<Vec<u8>>;
    async fn validate_points(&self, io_points: &[IoPoint]) -> Result<ValidationResult>;
    
    // 扩展接口
    fn supports_graphics(&self) -> bool { false }
    fn supports_scripts(&self) -> bool { false }
}
```

#### 数据源插件接口
```rust
#[async_trait]
pub trait DataSourcePlugin: Send + Sync {
    fn name(&self) -> &str;
    fn data_source_type(&self) -> DataSourceType;
    
    async fn configure(&mut self, config: &DataSourceConfig) -> Result<()>;
    async fn test_connection(&self) -> Result<bool>;
    async fn sync_projects(&self) -> Result<Vec<Project>>;
    async fn sync_stations(&self, project_id: &str) -> Result<Vec<Station>>;
    async fn sync_devices(&self, station_id: &str) -> Result<Vec<Device>>;
    
    // 扩展接口
    fn supports_real_time(&self) -> bool { false }
    fn supports_batch_sync(&self) -> bool { false }
}
```

#### AI服务插件接口
```rust
#[async_trait]
pub trait AiServicePlugin: Send + Sync {
    fn name(&self) -> &str;
    fn service_type(&self) -> AiServiceType;
    
    async fn configure(&mut self, config: &AiConfig) -> Result<()>;
    async fn parse_design_document(&self, file_data: &[u8], file_type: &str) -> Result<ParsedData>;
    async fn suggest_io_mapping(&self, devices: &[Device], io_points: &[IoPoint]) -> Result<Vec<IoMapping>>;
    async fn validate_configuration(&self, config: &PlcConfiguration) -> Result<ValidationSuggestions>;
    
    // 扩展接口
    fn supports_image_analysis(&self) -> bool { false }
    fn supports_natural_language(&self) -> bool { false }
}
```

### 2. 插件注册与管理

#### 插件注册器
```rust
pub struct PluginRegistry {
    plc_plugins: HashMap<String, Box<dyn PlcPlugin>>,
    hmi_plugins: HashMap<String, Box<dyn HmiPlugin>>,
    data_source_plugins: HashMap<String, Box<dyn DataSourcePlugin>>,
    ai_service_plugins: HashMap<String, Box<dyn AiServicePlugin>>,
}

impl PluginRegistry {
    pub fn new() -> Self {
        let mut registry = Self {
            plc_plugins: HashMap::new(),
            hmi_plugins: HashMap::new(),
            data_source_plugins: HashMap::new(),
            ai_service_plugins: HashMap::new(),
        };
        
        // 注册内置插件
        registry.register_builtin_plugins();
        registry
    }
    
    pub fn register_plc_plugin(&mut self, plugin: Box<dyn PlcPlugin>) {
        self.plc_plugins.insert(plugin.name().to_string(), plugin);
    }
    
    pub fn get_plc_plugin(&self, name: &str) -> Option<&dyn PlcPlugin> {
        self.plc_plugins.get(name).map(|p| p.as_ref())
    }
    
    pub fn list_plc_plugins(&self) -> Vec<&str> {
        self.plc_plugins.keys().map(|k| k.as_str()).collect()
    }
    
    // 动态加载插件
    pub async fn load_plugin_from_file(&mut self, path: &str) -> Result<()> {
        // 实现动态库加载逻辑
        todo!()
    }
}
```

### 3. 插件配置管理

#### 插件配置结构
```rust
#[derive(Debug, Serialize, Deserialize)]
pub struct PluginConfig {
    pub enabled: bool,
    pub priority: i32,
    pub settings: serde_json::Value,
    pub dependencies: Vec<String>,
}

#[derive(Debug, Serialize, Deserialize)]
pub struct PluginManifest {
    pub name: String,
    pub version: String,
    pub description: String,
    pub author: String,
    pub plugin_type: PluginType,
    pub entry_point: String,
    pub dependencies: Vec<PluginDependency>,
    pub config_schema: serde_json::Value,
}
```

### 4. 文件处理插件系统

#### 文件处理器接口
```rust
#[async_trait]
pub trait FileProcessor: Send + Sync {
    fn supported_extensions(&self) -> Vec<&str>;
    fn processor_name(&self) -> &str;
    
    async fn validate_file(&self, file_data: &[u8], filename: &str) -> Result<ValidationResult>;
    async fn parse_file(&self, file_data: &[u8], filename: &str) -> Result<ParsedFileData>;
    async fn convert_format(&self, data: &ParsedFileData, target_format: &str) -> Result<Vec<u8>>;
}

// Excel处理器实现
pub struct ExcelProcessor {
    use_python_bridge: bool,
}

#[async_trait]
impl FileProcessor for ExcelProcessor {
    fn supported_extensions(&self) -> Vec<&str> {
        vec!["xlsx", "xls", "xlsm"]
    }
    
    fn processor_name(&self) -> &str {
        "Excel Processor"
    }
    
    async fn parse_file(&self, file_data: &[u8], filename: &str) -> Result<ParsedFileData> {
        if self.use_python_bridge || self.is_complex_format(file_data) {
            // 使用Python桥接处理复杂Excel文件
            self.parse_with_python(file_data, filename).await
        } else {
            // 使用Rust原生处理
            self.parse_with_rust(file_data, filename).await
        }
    }
}
```

## 数据库设计

### 核心表结构

#### 1. 用户与权限管理
```sql
-- 用户表
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role_id UUID REFERENCES roles(id),
    is_active BOOLEAN DEFAULT true,
    last_login TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 角色表
CREATE TABLE roles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    permissions JSONB NOT NULL DEFAULT '[]',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 2. 项目与场站管理
```sql
-- 项目表
CREATE TABLE projects (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_code VARCHAR(50) UNIQUE NOT NULL,
    project_name VARCHAR(200) NOT NULL,
    description TEXT,
    status VARCHAR(20) DEFAULT 'active',
    metadata JSONB DEFAULT '{}',
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 场站表
CREATE TABLE stations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_id UUID REFERENCES projects(id) ON DELETE CASCADE,
    station_code VARCHAR(50) NOT NULL,
    station_name VARCHAR(200) NOT NULL,
    location VARCHAR(200),
    description TEXT,
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(project_id, station_code)
);
```

#### 3. 设备管理
```sql
-- 设备表
CREATE TABLE devices (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id) ON DELETE CASCADE,
    device_code VARCHAR(50) NOT NULL,
    device_name VARCHAR(200) NOT NULL,
    device_type VARCHAR(50),
    manufacturer VARCHAR(100),
    model VARCHAR(100),
    description TEXT,
    properties JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(station_id, device_code)
);
```

#### 4. PLC配置管理
```sql
-- PLC模块定义表
CREATE TABLE plc_modules (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    brand VARCHAR(50) NOT NULL,
    series VARCHAR(50) NOT NULL,
    model VARCHAR(100) NOT NULL,
    module_type VARCHAR(50) NOT NULL,
    io_type VARCHAR(20) NOT NULL,
    channel_count INTEGER NOT NULL,
    description TEXT,
    properties JSONB DEFAULT '{}',
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- PLC机架表
CREATE TABLE plc_racks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id) ON DELETE CASCADE,
    rack_no INTEGER NOT NULL,
    rack_type VARCHAR(50) NOT NULL,
    max_slots INTEGER NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(station_id, rack_no)
);

-- PLC配置表
CREATE TABLE plc_configurations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id) ON DELETE CASCADE,
    rack_id UUID REFERENCES plc_racks(id) ON DELETE CASCADE,
    slot_no INTEGER NOT NULL,
    module_id UUID REFERENCES plc_modules(id),
    configuration JSONB DEFAULT '{}',
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(rack_id, slot_no)
);

-- IO通道表
CREATE TABLE io_channels (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    plc_config_id UUID REFERENCES plc_configurations(id) ON DELETE CASCADE,
    channel_no INTEGER NOT NULL,
    io_point_id UUID REFERENCES io_points(id),
    description TEXT,
    is_used BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(plc_config_id, channel_no)
);
```

#### 5. IO点表管理
```sql
-- IO点位表
CREATE TABLE io_points (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id) ON DELETE CASCADE,
    device_id UUID REFERENCES devices(id),
    tag_name VARCHAR(100) NOT NULL,
    description TEXT,
    io_type VARCHAR(20) NOT NULL,
    data_type VARCHAR(20) NOT NULL,
    address VARCHAR(100),
    scale_factor DECIMAL(10,4) DEFAULT 1.0,
    units VARCHAR(20),
    low_limit DECIMAL(10,4),
    high_limit DECIMAL(10,4),
    properties JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(station_id, tag_name)
);
```

#### 6. 第三方设备管理
```sql
-- 第三方设备模板表
CREATE TABLE third_party_templates (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    device_type VARCHAR(50) NOT NULL,
    manufacturer VARCHAR(100),
    communication_protocol VARCHAR(50),
    point_definitions JSONB NOT NULL DEFAULT '[]',
    description TEXT,
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 第三方设备实例表
CREATE TABLE third_party_devices (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id) ON DELETE CASCADE,
    template_id UUID REFERENCES third_party_templates(id),
    device_name VARCHAR(200) NOT NULL,
    device_id VARCHAR(50) NOT NULL,
    address VARCHAR(100),
    configuration JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(station_id, device_id)
);
```

#### 7. 数据源与插件管理
```sql
-- 数据源配置表
CREATE TABLE data_sources (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    source_type VARCHAR(50) NOT NULL,
    configuration JSONB NOT NULL DEFAULT '{}',
    is_active BOOLEAN DEFAULT true,
    last_sync TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 插件配置表
CREATE TABLE plugin_configs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    plugin_name VARCHAR(100) NOT NULL,
    plugin_type VARCHAR(50) NOT NULL,
    version VARCHAR(20) NOT NULL,
    enabled BOOLEAN DEFAULT true,
    priority INTEGER DEFAULT 0,
    settings JSONB DEFAULT '{}',
    dependencies JSONB DEFAULT '[]',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(plugin_name, plugin_type)
);
```

#### 8. 系统设置
```sql
-- 系统设置表
CREATE TABLE system_settings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    key VARCHAR(100) UNIQUE NOT NULL,
    value JSONB NOT NULL,
    description TEXT,
    category VARCHAR(50) DEFAULT 'general',
    updated_by UUID REFERENCES users(id),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## API接口设计

### RESTful API规范

#### 1. 认证与用户管理
```
POST   /api/auth/login              # 用户登录
POST   /api/auth/logout             # 用户登出
GET    /api/auth/me                 # 获取当前用户信息
PUT    /api/auth/password           # 修改密码
POST   /api/auth/refresh            # 刷新Token

GET    /api/users                   # 获取用户列表
GET    /api/users/{id}              # 获取用户详情
POST   /api/users                   # 创建用户
PUT    /api/users/{id}              # 更新用户
DELETE /api/users/{id}              # 删除用户

GET    /api/roles                   # 获取角色列表
POST   /api/roles                   # 创建角色
PUT    /api/roles/{id}              # 更新角色
DELETE /api/roles/{id}              # 删除角色
```

#### 2. 项目与场站管理
```
GET    /api/projects                # 获取项目列表
GET    /api/projects/{id}           # 获取项目详情
POST   /api/projects                # 创建项目
PUT    /api/projects/{id}           # 更新项目
DELETE /api/projects/{id}           # 删除项目

GET    /api/projects/{id}/stations  # 获取项目下的场站
GET    /api/stations/{id}           # 获取场站详情
POST   /api/stations                # 创建场站
PUT    /api/stations/{id}           # 更新场站
DELETE /api/stations/{id}           # 删除场站
```

#### 3. 设备管理
```
GET    /api/stations/{id}/devices   # 获取场站设备列表
GET    /api/devices/{id}            # 获取设备详情
POST   /api/devices                 # 创建设备
PUT    /api/devices/{id}            # 更新设备
DELETE /api/devices/{id}            # 删除设备
```

#### 4. PLC配置管理
```
GET    /api/plc/modules             # 获取可用PLC模块
GET    /api/plc/modules/{brand}     # 获取特定品牌PLC模块
POST   /api/plc/modules             # 添加PLC模块定义

GET    /api/stations/{id}/racks     # 获取场站PLC机架
POST   /api/stations/{id}/racks     # 创建PLC机架
PUT    /api/racks/{id}              # 更新PLC机架
DELETE /api/racks/{id}              # 删除PLC机架

GET    /api/stations/{id}/plc-config    # 获取场站PLC配置
POST   /api/stations/{id}/plc-config    # 保存场站PLC配置
PUT    /api/stations/{id}/plc-config    # 更新场站PLC配置
DELETE /api/stations/{id}/plc-config    # 删除场站PLC配置

POST   /api/stations/{id}/plc-config/validate  # 验证PLC配置
GET    /api/stations/{id}/io-channels           # 获取IO通道列表
POST   /api/stations/{id}/io-channels/mapping   # 配置IO通道映射
```

#### 5. 第三方设备管理
```
GET    /api/third-party/templates   # 获取设备模板列表
GET    /api/third-party/templates/{id}  # 获取设备模板详情
POST   /api/third-party/templates   # 创建设备模板
PUT    /api/third-party/templates/{id}  # 更新设备模板
DELETE /api/third-party/templates/{id}  # 删除设备模板

GET    /api/stations/{id}/third-party-devices  # 获取场站第三方设备
POST   /api/stations/{id}/third-party-devices  # 添加第三方设备
PUT    /api/third-party-devices/{id}           # 更新第三方设备
DELETE /api/third-party-devices/{id}           # 删除第三方设备
```

#### 6. IO点表处理
```
POST   /api/io/upload               # 上传IO点表文件
POST   /api/io/validate             # 验证IO点表
POST   /api/io/parse                # 解析IO点表

GET    /api/stations/{id}/io-points # 获取场站IO点位
POST   /api/stations/{id}/io-points/import  # 导入IO点位
GET    /api/stations/{id}/io-points/export  # 导出IO点位
```

#### 7. 点表生成
```
POST   /api/generate/plc/{plugin_name}     # 生成PLC点表
POST   /api/generate/hmi/{plugin_name}     # 生成HMI点表
POST   /api/generate/fat                   # 生成FAT测试点表
POST   /api/generate/communication        # 生成上下位通讯点表
POST   /api/generate/template             # 生成IO点表模板
```

#### 8. 插件管理
```
GET    /api/plugins                 # 获取插件列表
GET    /api/plugins/{type}          # 获取特定类型插件
POST   /api/plugins/install         # 安装插件
PUT    /api/plugins/{name}/config   # 配置插件
DELETE /api/plugins/{name}          # 卸载插件
POST   /api/plugins/{name}/enable   # 启用插件
POST   /api/plugins/{name}/disable  # 禁用插件
```

#### 9. 数据源管理
```
GET    /api/data-sources            # 获取数据源列表
POST   /api/data-sources            # 创建数据源
PUT    /api/data-sources/{id}       # 更新数据源
DELETE /api/data-sources/{id}       # 删除数据源
POST   /api/data-sources/{id}/test  # 测试数据源连接
POST   /api/data-sources/{id}/sync  # 同步数据源数据
```

#### 10. AI集成
```
POST   /api/ai/parse-document        # AI解析设计文档
POST   /api/ai/suggest-mapping       # AI建议IO映射
POST   /api/ai/validate-config       # AI验证配置
POST   /api/ai/optimize-config       # AI优化配置
```

## 部署架构

### Docker容器化部署

#### 1. 服务组件
```yaml
# docker-compose.yml
version: '3.8'

services:
  # Rust后端服务
  backend:
    build: ./backend
    ports:
      - "8080:8080"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/plc_management
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    volumes:
      - ./uploads:/app/uploads
      - ./plugins:/app/plugins

  # Angular前端服务
  frontend:
    build: ./frontend
    ports:
      - "4200:80"
    depends_on:
      - backend

  # Python微服务
  python-services:
    build: ./python-services
    ports:
      - "8000:8000"
    environment:
      - BACKEND_URL=http://backend:8080
    volumes:
      - ./uploads:/app/uploads

  # PostgreSQL数据库
  postgres:
    image: postgres:15
    environment:
      - POSTGRES_DB=plc_management
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./migrations:/docker-entrypoint-initdb.d

  # Redis缓存
  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

  # Nginx反向代理
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
    depends_on:
      - frontend
      - backend

volumes:
  postgres_data:
  redis_data:
```

#### 2. Kubernetes部署配置
```yaml
# k8s/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: plc-management

---
# k8s/backend-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend
  namespace: plc-management
spec:
  replicas: 3
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
    spec:
      containers:
      - name: backend
        image: plc-management/backend:latest
        ports:
        - containerPort: 8080
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
```

### 微服务架构

#### 1. 服务拆分
- **认证服务**: 用户认证和授权
- **项目管理服务**: 项目和场站管理
- **设备管理服务**: 设备和IO点表管理
- **PLC配置服务**: PLC配置和验证
- **文件处理服务**: 文件上传和处理
- **点表生成服务**: 各种点表生成
- **插件管理服务**: 插件加载和管理
- **AI集成服务**: AI功能集成

#### 2. 服务通信
- **同步通信**: HTTP/REST API
- **异步通信**: 消息队列 (Redis Pub/Sub)
- **服务发现**: Consul或Kubernetes Service
- **负载均衡**: Nginx或Kubernetes Ingress

## 开发路线图

### 第一阶段：基础架构 (4-6周)
1. **项目初始化**
   - 创建Rust后端项目结构
   - 创建Angular前端项目结构
   - 设置开发环境和CI/CD

2. **核心框架搭建**
   - 实现插件系统核心框架
   - 实现数据库连接和基础模型
   - 实现认证和权限系统

3. **基础功能实现**
   - 用户管理和角色管理
   - 项目和场站管理
   - 基础API接口

### 第二阶段：核心功能 (6-8周)
1. **PLC配置功能**
   - PLC模块管理
   - 机架配置功能
   - 基础配置验证

2. **文件处理系统**
   - 文件上传功能
   - Excel文件解析
   - Python桥接实现

3. **IO点表管理**
   - IO点位管理
   - 点表导入导出
   - 数据验证

### 第三阶段：插件系统 (4-6周)
1. **插件框架完善**
   - 动态插件加载
   - 插件配置管理
   - 插件依赖管理

2. **内置插件实现**
   - 和利时PLC插件
   - 亚控HMI插件
   - 简道云数据源插件

3. **点表生成器**
   - PLC点表生成
   - HMI点表生成
   - 其他格式点表生成

### 第四阶段：高级功能 (6-8周)
1. **第三方设备管理**
   - 设备模板系统
   - 设备实例管理
   - 点位配置功能

2. **AI集成**
   - AI服务接口
   - 文档解析功能
   - 智能建议功能

3. **系统优化**
   - 性能优化
   - 缓存策略
   - 错误处理完善

### 第五阶段：扩展功能 (4-6周)
1. **国际化完善**
   - 完整的中英文支持
   - 多语言界面
   - 本地化配置

2. **部署和运维**
   - Docker化部署
   - 监控和日志
   - 备份和恢复

3. **文档和测试**
   - API文档
   - 用户手册
   - 自动化测试

## 总结

这个重构设计方案为工控系统点表管理平台提供了一个高度可扩展、模块化的现代架构。核心设计理念包括：

### 关键优势
1. **插件化架构**: 通过插件系统实现功能扩展，避免核心代码修改
2. **微服务友好**: 模块化设计支持服务拆分和独立部署
3. **技术栈现代化**: 使用Rust和Angular提供高性能和良好用户体验
4. **多格式支持**: 混合处理策略支持各种文件格式
5. **AI集成**: 预留AI接口支持智能化功能
6. **国际化支持**: 完整的多语言支持

### 扩展性保障
- **接口驱动**: 所有扩展功能通过标准接口实现
- **配置化**: 插件和功能通过配置文件管理
- **版本兼容**: 插件系统支持版本管理和兼容性检查
- **热插拔**: 支持运行时插件加载和卸载

这个架构能够很好地满足您提出的扩展性要求，确保在功能需求变化时不会产生连锁反应，同时为未来的功能扩展提供了坚实的基础。