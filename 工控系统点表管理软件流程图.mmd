flowchart TD
    %% 系统启动和登录
    A[系统启动] --> B[用户登录]
    B --> B1{登录验证}
    B1 -->|失败| B2[显示错误信息]
    B1 -->|成功| C[进入主界面]
    B2 --> B
    
    %% 权限验证
    C --> C1[权限验证拦截器]
    C1 --> C2{是否已登录}
    C2 -->|否| B
    C2 -->|是| C3[检查会话有效性]
    C3 --> C4{会话是否有效}
    C4 -->|否| B
    C4 -->|是| D[获取用户角色权限]
    
    %% 主要业务功能选择
    D --> E[选择业务功能]
    E --> E1[项目管理]
    E --> E2[设备管理]
    E --> E3[第三方设备配置]
    E --> E4[IO点表上传]
    E --> E5[通道分配]
    E --> E6[点表生成]
    
    %% 项目管理流程
    E1 --> F1[项目CRUD操作]
    F1 --> F11[创建项目]
    F1 --> F12[编辑项目]
    F1 --> F13[删除项目]
    F1 --> F14[查询项目]
    
    %% 设备管理流程
    E2 --> F2[设备CRUD操作]
    F2 --> F21[添加设备]
    F2 --> F22[编辑设备]
    F2 --> F23[删除设备]
    F2 --> F24[查询设备]
    
    %% 第三方设备配置流程
    E3 --> F3[第三方设备配置]
    F3 --> F31[模板管理]
    F3 --> F32[设备配置]
    F31 --> F311[创建模板]
    F31 --> F312[编辑模板]
    F32 --> F321[选择模板]
    F32 --> F322[设置前缀]
    F32 --> F323[生成配置]
    
    %% IO点表上传流程
    E4 --> F4[IO点表上传处理]
    F4 --> F41[文件选择验证]
    F41 --> F42[Excel解析]
    F42 --> F43[数据验证]
    F43 --> F44{验证是否通过}
    F44 -->|否| F45[显示错误报告]
    F44 -->|是| F46[数据处理存储]
    
    %% 通道分配流程
    E5 --> F5[通道分配]
    F5 --> F51{数据是否准备就绪}
    F51 -->|否| F52[提示准备数据]
    F51 -->|是| F53[创建分配方案]
    F53 --> F54[选择分配方式]
    F54 --> F541[手动分配]
    F54 --> F542[自动分配]
    F54 --> F543[智能分配]
    F541 --> F55[执行分配]
    F542 --> F55
    F543 --> F55
    F55 --> F56[验证分配结果]
    F56 --> F57[保存分配方案]
    
    %% 点表生成流程
    E6 --> F6[点表生成]
    F6 --> F61[选择点表类型]
    F61 --> F611[PLC点表]
    F61 --> F612[HMI点表]
    F61 --> F613[通讯点表]
    F61 --> F614[FAT点表]
    F611 --> F62[检测系统类型]
    F612 --> F63[选择HMI类型]
    F613 --> F64[生成通讯配置]
    F614 --> F65[生成测试清单]
    F62 --> F66[生成PLC文件]
    F63 --> F67[生成HMI文件]
    F64 --> F68[生成通讯文件]
    F65 --> F69[生成FAT文件]
    
    %% 数据持久化和输出
    F11 --> G[数据持久化]
    F12 --> G
    F13 --> G
    F14 --> G
    F21 --> G
    F22 --> G
    F23 --> G
    F24 --> G
    F311 --> G
    F312 --> G
    F321 --> G
    F322 --> G
    F323 --> G
    F46 --> G
    F57 --> G
    
    F66 --> H[文件输出]
    F67 --> H
    F68 --> H
    F69 --> H
    
    %% 界面更新和用户操作
    G --> I[界面状态更新]
    H --> I
    F45 --> I
    F52 --> I
    
    I --> J[显示操作结果]
    J --> K[用户继续操作或退出]
    K --> E
    K --> L[系统退出]
    
    %% 样式定义
    classDef startEnd fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef process fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef data fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    
    class A,L startEnd
    class B1,C2,C4,F44,F51 decision
    class G,H data